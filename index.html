<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ­Œã†æ›²ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>

  <style>
    :root{
      --bg:#0f1115; --card:#151922; --muted:#8b93a6;
      --accent:#6ae3ff; --accent2:#a1ff9f; --text:#e8ecf1;

      /* ğŸ¥ ã‚¯ãƒ­ãƒã‚­ãƒ¼ç”¨ã‚°ãƒªãƒ¼ãƒ³ */
      --chroma-green:#00ff00;
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto,
        "Hiragino Kaku Gothic ProN", "Noto Sans JP",
        "Yu Gothic UI", "YuGothic", Meiryo, sans-serif;
      background:#000; /* OBSç”¨ãªã‚‰é»’ã§OK */
      color:var(--text)
    }

    .container{max-width:1080px; margin:0 auto; padding:28px}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:24px}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}

    .card{
      background: #111;
      border-radius:18px;
      padding:18px
    }

    .roulette{
      display:grid;
      place-items:center;
      height:160px;
      border-radius:12px;
      background:#111;
      position:relative;
      overflow:hidden
    }

    /* ===============================
       ğŸ¯ çµæœè¡¨ç¤ºï¼ˆã‚¯ãƒ­ãƒã‚­ãƒ¼å¯¾å¿œï¼‰
       =============================== */
    #display{
      font-family:
        "èŠ±ã¨ã¡ã‚‡ã†ã¡ã‚‡",
        "HanaToChouchou",
        "Noto Sans JP",
        Meiryo,
        sans-serif;

      font-size:20px;           /* âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 20px */
      font-weight:400;
      letter-spacing:.05em;

      background: var(--chroma-green); /* âœ… ã‚¯ãƒ­ãƒã‚­ãƒ¼ç”¨ */
      color:#000;               /* æŠœãã‚„ã™ã„ã‚ˆã†é»’æ–‡å­— */

      padding:10px 16px;
      border-radius:6px;

      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width:100%;
    }

    .sub{font-size:12px; color:#aaa; margin-top:6px}

    textarea{
      width:100%;
      min-height:200px;
      background:#000;
      color:#fff;
    }

    input[type="number"]{
      background:#000;
      color:#fff;
    }

    button{
      margin-top:12px;
      padding:10px 16px;
      font-weight:700;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="grid">
      <!-- å·¦ï¼šæ›²å…¥åŠ› -->
      <section class="card">
        <textarea id="songs" placeholder="1è¡Œ=1æ›²"></textarea>

        <div style="display:flex; gap:12px; margin-top:10px">
          <div>
            <label>è¡¨ç¤ºã‚µã‚¤ã‚º(px)</label>
            <input id="fontSize" type="number" value="20" />
          </div>
          <div>
            <label>æœ€å¤§æ–‡å­—æ•°</label>
            <input id="maxChars" type="number" value="28" />
          </div>
        </div>
      </section>

      <!-- å³ï¼šè¡¨ç¤º -->
      <section class="card">
        <div class="roulette">
          <div id="display">æ›²åãŒã“ã“ã«è¡¨ç¤º</div>
        </div>
        <div class="sub" id="hint">æŠ½é¸ã‚¹ã‚¿ãƒ¼ãƒˆ</div>

        <button id="start">æŠ½é¸ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="stop">ã‚¹ãƒˆãƒƒãƒ—</button>
      </section>
    </div>
  </div>

  <script>
    const els = {
      songs: document.getElementById('songs'),
      display: document.getElementById('display'),
      start: document.getElementById('start'),
      stop: document.getElementById('stop'),
      fontSize: document.getElementById('fontSize'),
      maxChars: document.getElementById('maxChars'),
      hint: document.getElementById('hint')
    };

    let list = [];
    let spinning = false;
    let rafId = null;

    const clampText = (s, max) => {
      s = (s ?? '').replace(/\r?\n/g,' ');
      return s.length > max ? s.slice(0,max) + 'â€¦' : s;
    };

    const easeOutCubic = t => 1 - Math.pow(1 - t, 3);

    const spin = (duration = 3000) => {
      if (!list.length) return;
      spinning = true;
      els.hint.textContent = 'å›ã£ã¦ã„ã¾ã™â€¦';
      const start = performance.now();

      const step = now => {
        const t = Math.min(1, (now - start) / duration);
        const k = easeOutCubic(t);
        const hz = 30 - 25 * k;
        const interval = 1000 / hz;

        if (!step.last || now - step.last > interval) {
          step.last = now;
          const name = list[Math.floor(Math.random()*list.length)];
          els.display.textContent = clampText(name, +els.maxChars.value);
        }

        if (t < 1 && spinning) {
          rafId = requestAnimationFrame(step);
        } else {
          spinning = false;
          step.last = 0;
          const final = list[Math.floor(Math.random()*list.length)];
          els.display.textContent = clampText(final, +els.maxChars.value);
          els.hint.textContent = 'æŠ½é¸çµæœ';
        }
      };
      rafId = requestAnimationFrame(step);
    };

    els.start.onclick = () => {
      list = els.songs.value.split(/\r?\n|,|ã€/).map(s=>s.trim()).filter(Boolean);
      spin();
    };

    els.stop.onclick = () => {
      spinning = false;
      if (rafId) cancelAnimationFrame(rafId);
    };

    els.fontSize.oninput = () => {
      els.display.style.fontSize = els.fontSize.value + 'px';
    };
  </script>
</body>
</html>
